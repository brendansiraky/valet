---
phase: 04-pipeline-builder
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/pipeline-builder/template-dialog.tsx
  - app/routes/pipelines.$id.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Template variables persist after saving and appear when reopening Edit Template"
    - "Edit Template dialog shows previously saved variables with their names, descriptions, and default values"
  artifacts:
    - path: "app/components/pipeline-builder/template-dialog.tsx"
      provides: "TemplateDialog with initialVariables prop"
      contains: "initialVariables"
    - path: "app/routes/pipelines.$id.tsx"
      provides: "Route passing templateVariables to TemplateDialog"
      pattern: "initialVariables.*templateVariables"
  key_links:
    - from: "app/routes/pipelines.$id.tsx"
      to: "TemplateDialog"
      via: "initialVariables prop"
      pattern: "initialVariables=\\{templateVariables\\}"
---

<objective>
Fix TemplateDialog to load saved variables when editing an existing template.

Purpose: Currently, opening "Edit Template" on a pipeline with saved template variables shows an empty dialog instead of the previously saved variables. This breaks the user's ability to edit their template definitions.

Output: TemplateDialog loads and displays existing template variables; changes persist correctly.
</objective>

<execution_context>
@/Users/brendan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brendan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-pipeline-builder/04-UAT.md

@app/components/pipeline-builder/template-dialog.tsx
@app/routes/pipelines.$id.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add initialVariables prop to TemplateDialog</name>
  <files>app/components/pipeline-builder/template-dialog.tsx</files>
  <action>
Update TemplateDialog component to accept and use initialVariables:

1. Add `initialVariables?: TemplateVariable[]` to TemplateDialogProps interface

2. Accept `initialVariables` in the component destructuring

3. Change useState initialization:
   - From: `useState<TemplateVariable[]>([{ name: "", description: "", defaultValue: "" }])`
   - To: `useState<TemplateVariable[]>(initialVariables?.length ? initialVariables : [{ name: "", description: "", defaultValue: "" }])`

4. Add useEffect to reset state when initialVariables changes or dialog opens:
   ```typescript
   useEffect(() => {
     if (open) {
       setVariables(
         initialVariables?.length
           ? initialVariables
           : [{ name: "", description: "", defaultValue: "" }]
       );
     }
   }, [open, initialVariables]);
   ```

5. Remove the reset in handleSave (line 63) since useEffect now handles state reset on dialog open
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>TemplateDialog accepts initialVariables prop and uses it to populate the form when dialog opens</done>
</task>

<task type="auto">
  <name>Task 2: Pass templateVariables to TemplateDialog in route</name>
  <files>app/routes/pipelines.$id.tsx</files>
  <action>
Update TemplateDialog usage in pipelines.$id.tsx to pass initialVariables:

1. Find the TemplateDialog component (around line 276)

2. Add the initialVariables prop:
   ```tsx
   <TemplateDialog
     open={templateDialogOpen}
     onOpenChange={setTemplateDialogOpen}
     pipelineId={pipelineId}
     onSave={handleSaveTemplate}
     initialVariables={templateVariables}
   />
   ```

The templateVariables state already exists (line 73-75) and is correctly initialized from the loader's template.variables.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>TemplateDialog receives templateVariables as initialVariables prop</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. Dev server starts: `npm run dev`
3. Manual test:
   - Navigate to an existing pipeline with saved template variables
   - Click "Edit Template" button
   - Dialog should show the previously saved variables with their names, descriptions, and default values
   - Modify a variable and save
   - Reopen dialog - changes should persist
</verification>

<success_criteria>
- TemplateDialog accepts initialVariables prop
- Opening "Edit Template" on a pipeline with saved variables shows those variables populated in the form
- Variables can be edited and saved, with changes persisting on reopen
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-pipeline-builder/04-05-SUMMARY.md`
</output>
