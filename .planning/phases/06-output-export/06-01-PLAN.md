---
phase: 06-output-export
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - app/app.css
  - app/lib/download.ts
  - app/components/ui/tabs.tsx
  - app/components/output-viewer/markdown-viewer.tsx
autonomous: true

must_haves:
  truths:
    - "Markdown content renders with proper typography styling"
    - "Download functions create and trigger file downloads"
    - "Tabs component available for multi-section display"
  artifacts:
    - path: "app/lib/download.ts"
      provides: "Client-side file download utilities"
      exports: ["downloadTextFile", "downloadMarkdownFile", "sanitizeFilename"]
    - path: "app/components/output-viewer/markdown-viewer.tsx"
      provides: "Safe markdown rendering with prose styling"
      exports: ["MarkdownViewer"]
    - path: "app/components/ui/tabs.tsx"
      provides: "shadcn Tabs component"
      contains: "TabsTrigger"
  key_links:
    - from: "app/app.css"
      to: "@tailwindcss/typography"
      via: "@plugin directive"
      pattern: "@plugin.*typography"
    - from: "app/components/output-viewer/markdown-viewer.tsx"
      to: "react-markdown"
      via: "import"
      pattern: "import.*from.*react-markdown"
---

<objective>
Install dependencies and create foundational components for output viewing and file downloads.

Purpose: Establish the infrastructure needed for rendering pipeline outputs as styled markdown and enabling client-side file downloads.

Output: Download utility module, MarkdownViewer component, Tabs component, and typography plugin configured.
</objective>

<execution_context>
@/Users/brendan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brendan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-output-export/06-RESEARCH.md
@app/app.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and configure typography</name>
  <files>package.json, package-lock.json, app/app.css, app/components/ui/tabs.tsx</files>
  <action>
    1. Install npm packages:
       - react-markdown (^9.x)
       - remark-gfm (^4.x)
       - @tailwindcss/typography (^0.5.x)

    2. Add typography plugin to app/app.css using Tailwind v4 @plugin directive:
       ```css
       @plugin "@tailwindcss/typography";
       ```
       Add after the existing @import statements.

    3. Add shadcn Tabs component:
       ```bash
       npx shadcn@latest add tabs --yes
       ```

    Note: Use @plugin directive (Tailwind v4 CSS-first configuration), NOT tailwind.config.js.
  </action>
  <verify>
    - `npm ls react-markdown remark-gfm @tailwindcss/typography` shows all installed
    - `app/app.css` contains `@plugin "@tailwindcss/typography"`
    - `app/components/ui/tabs.tsx` exists
  </verify>
  <done>Dependencies installed, typography plugin configured, Tabs component available</done>
</task>

<task type="auto">
  <name>Task 2: Create download utility module</name>
  <files>app/lib/download.ts</files>
  <action>
    Create client-side download utilities using Blob API (no server round-trip needed):

    ```typescript
    /**
     * Download content as a text file.
     * Uses Blob API for client-side file generation.
     */
    export function downloadTextFile(content: string, filename: string): void {
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      triggerDownload(blob, filename);
    }

    /**
     * Download content as a markdown file.
     */
    export function downloadMarkdownFile(content: string, filename: string): void {
      const blob = new Blob([content], { type: 'text/markdown;charset=utf-8' });
      triggerDownload(blob, filename);
    }

    /**
     * Sanitize a string for use as a filename.
     * Removes forbidden characters and limits length.
     */
    export function sanitizeFilename(name: string): string {
      return name
        .replace(/[/\\?%*:|"<>]/g, '-')  // Replace forbidden chars
        .replace(/\s+/g, '-')            // Replace spaces with dashes
        .replace(/-+/g, '-')             // Collapse multiple dashes
        .replace(/^-|-$/g, '')           // Remove leading/trailing dashes
        .slice(0, 200);                  // Limit length
    }

    /**
     * Internal helper to trigger file download via temporary anchor element.
     * Always revokes object URL to prevent memory leaks.
     */
    function triggerDownload(blob: Blob, filename: string): void {
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }
    ```
  </action>
  <verify>
    - File exists at app/lib/download.ts
    - Exports downloadTextFile, downloadMarkdownFile, sanitizeFilename
    - triggerDownload is internal (not exported)
  </verify>
  <done>Download utilities available for text and markdown file generation</done>
</task>

<task type="auto">
  <name>Task 3: Create MarkdownViewer component</name>
  <files>app/components/output-viewer/markdown-viewer.tsx</files>
  <action>
    Create a reusable markdown rendering component with prose styling:

    ```typescript
    import Markdown from 'react-markdown';
    import remarkGfm from 'remark-gfm';
    import { cn } from '~/lib/utils';

    interface MarkdownViewerProps {
      content: string;
      className?: string;
    }

    /**
     * Renders markdown content with Tailwind typography styling.
     * Supports GitHub Flavored Markdown (tables, task lists, strikethrough).
     * Safe by default - no dangerouslySetInnerHTML.
     */
    export function MarkdownViewer({ content, className }: MarkdownViewerProps) {
      return (
        <article
          className={cn(
            "prose prose-sm dark:prose-invert max-w-none",
            // Ensure proper spacing and readable line length
            "prose-headings:mt-4 prose-headings:mb-2",
            "prose-p:my-2 prose-pre:my-2",
            className
          )}
        >
          <Markdown remarkPlugins={[remarkGfm]}>
            {content}
          </Markdown>
        </article>
      );
    }
    ```

    Key points:
    - Use `max-w-none` to prevent typography width constraints clashing with container
    - Use `dark:prose-invert` for dark mode compatibility
    - Use `prose-sm` for more compact display suitable for output viewing
    - remarkGfm enables tables, task lists, and strikethrough
  </action>
  <verify>
    - File exists at app/components/output-viewer/markdown-viewer.tsx
    - Component imports react-markdown and remark-gfm
    - Uses prose classes with dark mode support
    - TypeScript compiles without errors: `npx tsc --noEmit`
  </verify>
  <done>MarkdownViewer component renders markdown with proper typography and dark mode support</done>
</task>

</tasks>

<verification>
Run these checks after all tasks complete:

1. Dependencies installed:
   ```bash
   npm ls react-markdown remark-gfm @tailwindcss/typography
   ```

2. TypeScript compiles:
   ```bash
   npx tsc --noEmit
   ```

3. Dev server starts without errors:
   ```bash
   npm run dev
   ```
   (Check for CSS/plugin loading errors in terminal)
</verification>

<success_criteria>
- react-markdown, remark-gfm, @tailwindcss/typography installed
- Typography plugin configured in app.css via @plugin directive
- Tabs component available at app/components/ui/tabs.tsx
- Download utilities at app/lib/download.ts with proper memory cleanup
- MarkdownViewer component renders markdown with prose styling
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-output-export/06-01-SUMMARY.md`
</output>
