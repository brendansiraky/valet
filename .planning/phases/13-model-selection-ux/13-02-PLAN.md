---
phase: 13-model-selection-ux
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/routes/settings.tsx
autonomous: true

must_haves:
  truths:
    - "Settings page model dropdown shows models grouped by provider"
    - "Only models for configured providers appear in settings dropdown"
    - "User can change default model and save preference"
  artifacts:
    - path: "app/routes/settings.tsx"
      provides: "Grouped model selector in settings"
      contains: "SelectGroup"
  key_links:
    - from: "app/routes/settings.tsx"
      to: "app/lib/models.ts"
      via: "ANTHROPIC_MODELS and OPENAI_MODELS imports"
      pattern: "import.*ANTHROPIC_MODELS"
---

<objective>
Update the settings page model preference selector to use grouped provider sections.

Purpose: Consistency with agent form model selector - users should see the same grouped UX everywhere models are selected.

Output: Settings page with grouped model dropdown that filters by configured providers.
</objective>

<execution_context>
@/Users/brendan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brendan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@app/routes/settings.tsx
@app/lib/models.ts
@app/components/ui/select.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update settings model selector with provider grouping</name>
  <files>app/routes/settings.tsx</files>
  <action>
Update the settings page model preference section to use grouped selection:

1. Update imports to include per-provider model arrays and SelectGroup/SelectLabel:
```tsx
import { ALL_MODELS, ANTHROPIC_MODELS, OPENAI_MODELS } from "~/lib/models";
import {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectTrigger,
  SelectValue,
} from "~/components/ui/select";
```

2. In the loader return, add hasOpenAIKey to the conditions (already exists) and ensure both are available for the component.

3. Find the Model Preference section in the component (around line 316-345). Replace the flat Select with grouped version:

Current code:
```tsx
<Select name="modelPreference" defaultValue={modelPreference}>
  <SelectTrigger className="w-full">
    <SelectValue placeholder="Select a model" />
  </SelectTrigger>
  <SelectContent>
    {availableModels.map((model) => (
      <SelectItem key={model.id} value={model.id}>
        {model.name}
      </SelectItem>
    ))}
  </SelectContent>
</Select>
```

Replace with:
```tsx
<Select name="modelPreference" defaultValue={modelPreference}>
  <SelectTrigger className="w-full">
    <SelectValue placeholder="Select a model" />
  </SelectTrigger>
  <SelectContent>
    {hasApiKey && (
      <SelectGroup>
        <SelectLabel>Anthropic</SelectLabel>
        {ANTHROPIC_MODELS.map((model) => (
          <SelectItem key={model.id} value={model.id}>
            {model.name}
          </SelectItem>
        ))}
      </SelectGroup>
    )}
    {hasOpenAIKey && (
      <SelectGroup>
        <SelectLabel>OpenAI</SelectLabel>
        {OPENAI_MODELS.map((model) => (
          <SelectItem key={model.id} value={model.id}>
            {model.name}
          </SelectItem>
        ))}
      </SelectGroup>
    )}
  </SelectContent>
</Select>
```

4. Update the condition for showing the Model Selection section from `{hasApiKey && (...)}` to show if ANY provider key is configured:
```tsx
{(hasApiKey || hasOpenAIKey) && (
  <div className="space-y-4 border-t pt-6">
    ...
  </div>
)}
```

5. Update the section header text:
- Change "Model Preference" to "Default Model"
- Update description: "Select the default model for your agents. Agents can override this with their own model selection."

6. The availableModels variable is no longer needed in the component since we're using ANTHROPIC_MODELS and OPENAI_MODELS directly. You can remove it from the useLoaderData destructure if desired (optional cleanup).
  </action>
  <verify>
1. TypeScript compiles: `npx tsc --noEmit`
2. Visit http://localhost:5173/settings
3. Model dropdown shows Anthropic section (if key configured)
4. Model dropdown shows OpenAI section (if key configured)
5. Saving model preference works correctly
  </verify>
  <done>
- Settings page model dropdown uses SelectGroup/SelectLabel for provider grouping
- Only sections for configured providers are shown
- Default model can be from any configured provider
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Visit /settings - model dropdown shows grouped models by provider
3. Only configured provider sections appear
4. Selecting and saving a model from either provider works
5. If no keys configured, model section is hidden entirely
</verification>

<success_criteria>
- Settings model selector uses grouped provider sections
- Matches the UX pattern from agent form
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-model-selection-ux/13-02-SUMMARY.md`
</output>
