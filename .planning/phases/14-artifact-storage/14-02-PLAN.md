---
phase: 14-artifact-storage
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - app/routes/artifacts.tsx
  - app/routes/artifacts.$id.tsx
  - app/components/nav-main.tsx
autonomous: true

must_haves:
  truths:
    - "User can see list of past pipeline run outputs"
    - "User can view details of a specific artifact"
    - "Artifact list shows pipeline name, date, model, cost"
    - "Artifact detail shows step outputs and final output with usage"
  artifacts:
    - path: "app/routes/artifacts.tsx"
      provides: "Artifact list page with pagination"
      exports: ["loader", "default"]
    - path: "app/routes/artifacts.$id.tsx"
      provides: "Artifact detail page"
      exports: ["loader", "default"]
    - path: "app/components/nav-main.tsx"
      provides: "Navigation with Artifacts link"
      contains: "Artifacts"
  key_links:
    - from: "app/routes/artifacts.tsx"
      to: "app/db/schema/pipeline-runs.ts"
      via: "db.select with join"
      pattern: "pipelineRuns.*artifactData"
    - from: "app/routes/artifacts.$id.tsx"
      to: "app/components/output-viewer/output-viewer.tsx"
      via: "OutputViewer component"
      pattern: "OutputViewer"
---

<objective>
Create artifact viewer UI - list page with pagination and detail page reusing OutputViewer.

Purpose: Users can browse and view past pipeline outputs.
Output: Two new routes (artifacts, artifacts.$id) and navigation link.
</objective>

<execution_context>
@/Users/brendan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brendan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-artifact-storage/14-RESEARCH.md
@.planning/phases/14-artifact-storage/14-01-SUMMARY.md
@app/routes/pipelines.tsx
@app/components/output-viewer/output-viewer.tsx
@app/components/nav-main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create artifact list route with navigation</name>
  <files>app/routes/artifacts.tsx, app/components/nav-main.tsx</files>
  <action>
  1. Create app/routes/artifacts.tsx following pipelines.tsx pattern:

  Loader:
  - Get session, redirect to /login if not authenticated
  - Parse page from URL query params (default 1), pageSize = 20
  - Query pipelineRuns joined with pipelines:
    - Select: id, pipelineName (from pipelines.name), model, inputTokens, outputTokens, cost, completedAt
    - Where: userId matches, status = "completed"
    - Order by: completedAt DESC
    - Limit/offset for pagination
  - Also get total count for pagination UI
  - Return { artifacts, page, pageSize, totalCount }

  Component:
  - Page header: "Artifacts" with description "View past pipeline outputs"
  - Empty state if no artifacts: "No pipeline runs yet. Run a pipeline to see artifacts here."
  - Grid of artifact cards (similar to pipelines page):
    - Pipeline name as title
    - Subtitle: formatted date (e.g., "Jan 29, 2026 at 3:45 PM")
    - Show model name, token counts (use formatTokens), cost (use formatCost)
    - Card links to /artifacts/${id}
  - Simple pagination at bottom if totalCount > pageSize:
    - "Previous" and "Next" buttons using Link with ?page= query param
    - Show "Page X of Y"

  Imports needed:
  - Card components from ~/components/ui/card
  - Button from ~/components/ui/button
  - Link, redirect, useLoaderData from react-router
  - formatCost, formatTokens from ~/lib/pricing
  - db, pipelineRuns, pipelines from ~/db
  - eq, and, desc, count, sql from drizzle-orm
  - getSession from ~/services/session.server
  - FileText icon from lucide-react

  2. Update app/components/nav-main.tsx:
  - Add Artifacts link between Pipelines and Traits
  - Use FileText icon from lucide-react
  - URL: /artifacts
  </action>
  <verify>
  - `npm run typecheck` passes
  - `npm run dev` shows no errors
  - Navigate to /artifacts, see list or empty state
  - Artifacts link appears in sidebar
  - Cards show pipeline name, date, model, tokens, cost
  - Pagination controls work if more than 20 artifacts
  </verify>
  <done>
  - Artifacts list route at /artifacts with pagination
  - Empty state when no completed runs
  - Cards display metadata (pipeline, date, model, tokens, cost)
  - Sidebar navigation includes Artifacts link
  </done>
</task>

<task type="auto">
  <name>Task 2: Create artifact detail route</name>
  <files>app/routes/artifacts.$id.tsx</files>
  <action>
  Create app/routes/artifacts.$id.tsx:

  Loader:
  - Get session, redirect to /login if not authenticated
  - Get id from params
  - Query pipelineRuns joined with pipelines:
    - Select all columns from pipelineRuns, pipeline name
    - Where: id matches, userId matches
    - Return 404 if not found
  - Return { artifact, pipelineName }

  Component:
  - Page container matching other pages (container mx-auto py-8)
  - Back link at top: "Back to Artifacts" linking to /artifacts
  - Page header with pipeline name and date
  - Reuse OutputViewer component:
    - If artifactData exists, map steps to OutputViewer format
    - Otherwise, use empty steps array and finalOutput from artifact
    - Pass usage: { inputTokens, outputTokens } from artifact
    - Pass model from artifact
    - Pass pipelineName
  - Show additional metadata below OutputViewer if not in OutputViewer already:
    - Completed at (formatted date/time)

  Transform artifactData.steps to OutputViewer format:
  ```typescript
  const steps = artifact.artifactData?.steps.map(s => ({
    agentName: s.agentName,
    output: s.output,
  })) ?? [];
  const finalOutput = artifact.artifactData?.finalOutput ?? artifact.finalOutput ?? "";
  ```

  Imports needed:
  - OutputViewer from ~/components/output-viewer/output-viewer
  - Link, redirect, useLoaderData from react-router
  - ArrowLeft icon from lucide-react
  - Button from ~/components/ui/button
  - db, pipelineRuns, pipelines from ~/db
  - eq, and from drizzle-orm
  - getSession from ~/services/session.server
  </action>
  <verify>
  - `npm run typecheck` passes
  - Click artifact card on list page, navigates to detail
  - OutputViewer shows tabs for each step plus Final Output
  - Usage summary shows tokens and cost
  - Back button returns to artifacts list
  </verify>
  <done>
  - Artifact detail route at /artifacts/:id
  - Displays step outputs using OutputViewer
  - Shows metadata (date, model, tokens, cost)
  - Back navigation to artifacts list
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. `npm run typecheck` passes
2. Navigate to /artifacts from sidebar
3. If no completed runs, see empty state message
4. Run a pipeline to completion
5. Return to /artifacts, see the artifact card
6. Click card, view artifact detail with OutputViewer
7. Verify step tabs, final output, usage summary all work
8. Click back button, return to list
</verification>

<success_criteria>
- [ ] /artifacts route shows list of completed pipeline runs
- [ ] Empty state shows when no artifacts exist
- [ ] Artifact cards show pipeline name, date, model, tokens, cost
- [ ] Pagination works for >20 artifacts
- [ ] /artifacts/:id route shows artifact detail
- [ ] OutputViewer displays step outputs and final output
- [ ] Usage summary shows tokens and cost
- [ ] Back navigation works
- [ ] Artifacts link in sidebar navigation
</success_criteria>

<output>
After completion, create `.planning/phases/14-artifact-storage/14-02-SUMMARY.md`
</output>
