---
phase: 16-trait-colors
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/db/schema/traits.ts
  - app/lib/trait-colors.ts
  - app/components/color-swatch-picker.tsx
  - app/components/trait-form-dialog.tsx
  - app/components/trait-card.tsx
  - app/routes/traits.tsx
autonomous: true

must_haves:
  truths:
    - "User can select a color when creating a trait"
    - "User can change color when editing a trait"
    - "Trait cards display their assigned color"
    - "Existing traits have a default color after migration"
  artifacts:
    - path: "app/db/schema/traits.ts"
      provides: "Color field on traits table"
      contains: "color: text"
    - path: "app/lib/trait-colors.ts"
      provides: "Preset warm color palette"
      exports: ["TRAIT_COLORS", "DEFAULT_TRAIT_COLOR"]
    - path: "app/components/color-swatch-picker.tsx"
      provides: "Reusable color swatch picker component"
      exports: ["ColorSwatchPicker"]
    - path: "app/components/trait-form-dialog.tsx"
      provides: "Color picker integrated in form"
      contains: "ColorSwatchPicker"
    - path: "app/components/trait-card.tsx"
      provides: "Color border display"
      contains: "borderLeftColor"
  key_links:
    - from: "app/components/trait-form-dialog.tsx"
      to: "app/lib/trait-colors.ts"
      via: "import TRAIT_COLORS"
      pattern: "import.*TRAIT_COLORS"
    - from: "app/routes/traits.tsx"
      to: "app/db/schema/traits.ts"
      via: "color field in insert/update"
      pattern: "color:"
---

<objective>
Add color customization to traits with warm preset palette.

Purpose: Allow users to visually distinguish traits through color coding, improving UX when managing multiple traits.

Output:
- Database schema with color field + migration
- Preset warm color palette constant
- Color swatch picker component
- Form dialog with color selection
- Trait cards with color indicator
</objective>

<execution_context>
@/Users/brendan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brendan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-trait-colors/16-RESEARCH.md
@app/db/schema/traits.ts
@app/components/trait-form-dialog.tsx
@app/components/trait-card.tsx
@app/routes/traits.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add color field and constants</name>
  <files>
    app/db/schema/traits.ts
    app/lib/trait-colors.ts
  </files>
  <action>
1. Update `app/db/schema/traits.ts`:
   - Add `color: text("color").notNull().default("#f59e0b")` field after `context`
   - The default "#f59e0b" is warm amber

2. Create `app/lib/trait-colors.ts` with preset palette:
   ```typescript
   export const TRAIT_COLORS = [
     { name: "Amber", value: "#f59e0b" },
     { name: "Orange", value: "#f97316" },
     { name: "Coral", value: "#fb923c" },
     { name: "Terracotta", value: "#ea580c" },
     { name: "Red", value: "#ef4444" },
     { name: "Rose", value: "#f43f5e" },
     { name: "Pink", value: "#ec4899" },
     { name: "Wine", value: "#be123c" },
     { name: "Rust", value: "#dc2626" },
     { name: "Stone", value: "#78716c" },
   ] as const;

   export const DEFAULT_TRAIT_COLOR = TRAIT_COLORS[0].value;
   ```

3. Generate migration using drizzle-kit:
   ```bash
   npx drizzle-kit generate --name trait_colors
   ```
   This will create a migration file in drizzle/ folder.

4. Run migration:
   ```bash
   npx drizzle-kit push
   ```
  </action>
  <verify>
- `npx drizzle-kit push` completes without errors
- TypeScript compiles: `npx tsc --noEmit` passes
- Color field exists on Trait type
  </verify>
  <done>
- Traits table has color column with amber default
- TRAIT_COLORS and DEFAULT_TRAIT_COLOR exported from app/lib/trait-colors.ts
- Existing traits have default color value
  </done>
</task>

<task type="auto">
  <name>Task 2: Build color swatch picker component</name>
  <files>
    app/components/color-swatch-picker.tsx
  </files>
  <action>
Create `app/components/color-swatch-picker.tsx`:

```typescript
import { cn } from "~/lib/utils";

interface ColorSwatchPickerProps {
  value: string;
  onChange: (color: string) => void;
  colors: readonly { name: string; value: string }[];
}

export function ColorSwatchPicker({ value, onChange, colors }: ColorSwatchPickerProps) {
  return (
    <div className="flex flex-wrap gap-2">
      {colors.map((color) => (
        <button
          key={color.value}
          type="button"
          onClick={() => onChange(color.value)}
          className={cn(
            "h-8 w-8 rounded-full border-2 transition-transform hover:scale-110",
            value === color.value
              ? "border-foreground ring-2 ring-ring ring-offset-2"
              : "border-transparent"
          )}
          style={{ backgroundColor: color.value }}
          title={color.name}
          aria-label={`Select ${color.name} color`}
          aria-pressed={value === color.value}
        />
      ))}
    </div>
  );
}
```

Key implementation notes:
- Use inline `style={{ backgroundColor: color.value }}` for dynamic colors (Tailwind can't handle runtime hex values)
- Selected state uses ring + scale for clear visual feedback
- Accessible with aria-label and aria-pressed
  </action>
  <verify>
- File exists and exports ColorSwatchPicker
- TypeScript compiles: `npx tsc --noEmit` passes
  </verify>
  <done>
- ColorSwatchPicker component created with proper accessibility attributes
- Uses inline styles for dynamic color background
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate color picker into trait form and cards</name>
  <files>
    app/components/trait-form-dialog.tsx
    app/components/trait-card.tsx
    app/routes/traits.tsx
  </files>
  <action>
1. Update `app/components/trait-form-dialog.tsx`:
   - Import ColorSwatchPicker, TRAIT_COLORS, DEFAULT_TRAIT_COLOR
   - Add color state: `const [color, setColor] = useState(trait?.color ?? DEFAULT_TRAIT_COLOR);`
   - Reset color when dialog opens/closes if needed
   - Add hidden input: `<input type="hidden" name="color" value={color} />`
   - Add color picker section after context field:
     ```tsx
     <div className="space-y-2">
       <Label>Color</Label>
       <ColorSwatchPicker
         value={color}
         onChange={setColor}
         colors={TRAIT_COLORS}
       />
     </div>
     ```
   - Update TraitFormDialogProps to include color: `trait?: Pick<Trait, "id" | "name" | "context" | "color">`

2. Update `app/components/trait-card.tsx`:
   - Update TraitCardProps to include color: `trait: Pick<Trait, "id" | "name" | "context" | "color" | "updatedAt">`
   - Add color border to Card component:
     ```tsx
     <Card
       className="flex flex-col border-l-4"
       style={{ borderLeftColor: trait.color }}
     >
     ```

3. Update `app/routes/traits.tsx`:
   - Add color to loader query columns:
     ```typescript
     columns: {
       id: true,
       name: true,
       context: true,
       color: true,
       updatedAt: true,
     },
     ```
   - Update TraitSchema to include color:
     ```typescript
     const TraitSchema = z.object({
       name: z.string().min(1, "Name is required").max(100, "Name must be 100 characters or less"),
       context: z.string().min(1, "Context is required").max(50000, "Context must be 50,000 characters or less"),
       color: z.string().regex(/^#[0-9A-Fa-f]{6}$/, "Invalid color format").optional(),
     });
     ```
   - Update create action to include color:
     ```typescript
     await db.insert(traits).values({
       userId,
       name: result.data.name,
       context: result.data.context,
       color: result.data.color,
     });
     ```
   - Update update action to include color:
     ```typescript
     .set({
       name: result.data.name,
       context: result.data.context,
       color: result.data.color,
     })
     ```
  </action>
  <verify>
- `npm run dev` starts without errors
- Navigate to /traits
- Create new trait - color picker visible, can select colors
- Edit existing trait - color picker shows current color
- Trait cards display left border with trait color
  </verify>
  <done>
- Color picker integrated in trait create/edit dialog
- Trait cards show color as left border
- Color persists across page refresh
- All existing traits display default amber color
  </done>
</task>

</tasks>

<verification>
1. Database: `SELECT color FROM traits LIMIT 1` returns hex color value
2. Create flow: New trait can be created with selected color
3. Edit flow: Existing trait color can be changed
4. Display: Trait cards show colored left border
5. Default: Existing traits show amber (#f59e0b) border
6. TypeScript: `npx tsc --noEmit` passes
7. Dev server: `npm run dev` runs without errors
</verification>

<success_criteria>
- User can select a color from 10 warm presets when creating/editing a trait
- Trait cards in the Traits screen display their assigned color as a left border
- Existing traits automatically have the default amber color
- No TypeScript errors
- Dev server runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/16-trait-colors/16-01-SUMMARY.md`
</output>
