---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - vite.config.ts
  - app/root.tsx
  - app/routes/_index.tsx
  - app/db/index.ts
  - app/db/schema/users.ts
  - app/db/schema/sessions.ts
  - app/db/schema/api-keys.ts
  - drizzle.config.ts
  - docker-compose.yml
  - .env.example
  - tailwind.config.ts
  - app/tailwind.css
autonomous: true

must_haves:
  truths:
    - "Remix dev server starts without errors"
    - "PostgreSQL container runs and accepts connections"
    - "Database schema can be pushed to PostgreSQL"
    - "Tailwind CSS classes render correctly"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies"
      contains: "remix-auth"
    - path: "app/db/schema/users.ts"
      provides: "User table definition"
      contains: "users"
    - path: "app/db/schema/sessions.ts"
      provides: "Session table definition"
      contains: "sessions"
    - path: "app/db/schema/api-keys.ts"
      provides: "API key table definition"
      contains: "apiKeys"
    - path: "docker-compose.yml"
      provides: "PostgreSQL container"
      contains: "postgres"
  key_links:
    - from: "app/db/index.ts"
      to: "drizzle.config.ts"
      via: "shared connection string"
      pattern: "DATABASE_URL"
    - from: "app/db/schema/*.ts"
      to: "app/db/index.ts"
      via: "schema exports"
      pattern: "export.*from"
---

<objective>
Bootstrap the Remix project with all dependencies and create the database schema for users, sessions, and API keys.

Purpose: Establish the foundational project structure and data model that all subsequent auth work builds upon.
Output: Running Remix app with PostgreSQL database and complete schema ready for auth implementation.
</objective>

<execution_context>
@/Users/brendan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brendan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Remix project with dependencies</name>
  <files>
    package.json
    tsconfig.json
    vite.config.ts
    app/root.tsx
    app/routes/_index.tsx
    tailwind.config.ts
    app/tailwind.css
    .env.example
  </files>
  <action>
Create a new Remix project using `npx create-remix@latest . --template remix-run/remix/templates/vite` (accept defaults, use TypeScript).

After creation, install all required dependencies:
```bash
npm install remix-auth remix-auth-form argon2 drizzle-orm drizzle-zod zod @anthropic-ai/sdk @oslojs/encoding @oslojs/crypto postgres
npm install -D drizzle-kit @types/node tailwindcss postcss autoprefixer
```

Initialize Tailwind CSS:
```bash
npx tailwindcss init -p
```

Configure tailwind.config.ts to include app directory:
```typescript
export default {
  content: ["./app/**/*.{js,jsx,ts,tsx}"],
  theme: { extend: {} },
  plugins: [],
}
```

Create app/tailwind.css with Tailwind directives:
```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

Import tailwind.css in app/root.tsx via links export.

Create .env.example with required environment variables:
```
DATABASE_URL=postgres://postgres:postgres@localhost:5432/valet
SESSION_SECRET=your-session-secret-min-32-chars
ENCRYPTION_KEY=your-64-char-hex-key-for-aes-256
```

Verify the app starts with `npm run dev`.
  </action>
  <verify>
Run `npm run dev` - server starts on localhost:5173 without errors.
Run `npm ls remix-auth` - shows remix-auth installed.
Run `npm ls drizzle-orm` - shows drizzle-orm installed.
  </verify>
  <done>
Remix dev server runs successfully. All dependencies installed. Tailwind CSS configured and working.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create database schema and Docker setup</name>
  <files>
    app/db/index.ts
    app/db/schema/users.ts
    app/db/schema/sessions.ts
    app/db/schema/api-keys.ts
    drizzle.config.ts
    docker-compose.yml
  </files>
  <action>
Create docker-compose.yml for PostgreSQL:
```yaml
services:
  db:
    image: postgres:16-alpine
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: valet
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data

volumes:
  pgdata:
```

Create drizzle.config.ts:
```typescript
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  schema: "./app/db/schema/*",
  out: "./drizzle",
  dialect: "postgresql",
  dbCredentials: {
    url: process.env.DATABASE_URL!,
  },
});
```

Create app/db/schema/users.ts following the RESEARCH.md pattern:
- id: text primary key with crypto.randomUUID() default
- email: text, unique, not null
- passwordHash: text, not null
- createdAt: timestamp with defaultNow()
- updatedAt: timestamp with defaultNow() and $onUpdateFn

Create app/db/schema/sessions.ts:
- id: text primary key with crypto.randomUUID() default
- userId: text, references users.id with onDelete cascade (nullable for unauthenticated sessions)
- data: text, not null (JSON stringified session data)
- expiresAt: timestamp (nullable)
- createdAt: timestamp with defaultNow()

Create app/db/schema/api-keys.ts:
- id: text primary key with crypto.randomUUID() default
- userId: text, not null, references users.id with onDelete cascade
- encryptedKey: text, not null (AES-256-GCM encrypted)
- provider: text, not null, default "anthropic"
- modelPreference: text, default "claude-sonnet-4-5-20250929"
- createdAt: timestamp with defaultNow()
- updatedAt: timestamp with defaultNow() and $onUpdateFn

Create app/db/index.ts:
```typescript
import { drizzle } from "drizzle-orm/postgres-js";
import postgres from "postgres";
import * as users from "./schema/users";
import * as sessions from "./schema/sessions";
import * as apiKeys from "./schema/api-keys";

const connectionString = process.env.DATABASE_URL!;
const client = postgres(connectionString);

export const db = drizzle(client, {
  schema: { ...users, ...sessions, ...apiKeys },
});
```

Export all schema tables from their respective files.
  </action>
  <verify>
Run `docker compose up -d` - PostgreSQL container starts.
Run `docker compose ps` - shows db container running.
Create .env file from .env.example with real values.
Run `npx drizzle-kit push` - schema pushes to database without errors.
Run `npx drizzle-kit studio` - opens Drizzle Studio showing all 3 tables.
  </verify>
  <done>
PostgreSQL running in Docker. Schema files created with proper types and relations. Schema successfully pushed to database. All three tables (users, sessions, api_keys) visible in Drizzle Studio.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts Remix without errors
2. `docker compose ps` shows PostgreSQL running
3. `npx drizzle-kit push` succeeds
4. Database has users, sessions, api_keys tables
5. TypeScript compilation passes (`npm run typecheck` if available, or no TS errors in dev)
</verification>

<success_criteria>
- Remix dev server runs on localhost:5173
- PostgreSQL container accepts connections on localhost:5432
- All three database tables exist with correct columns
- All dependencies from RESEARCH.md standard stack are installed
- Tailwind CSS renders utility classes correctly
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
