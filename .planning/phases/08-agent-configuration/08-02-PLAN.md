---
phase: 08-agent-configuration
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - app/components/ui/checkbox.tsx
  - app/components/agent-form-dialog.tsx
autonomous: true

must_haves:
  truths:
    - "Agent form dialog shows capability dropdown with none/search/fetch options"
    - "Agent form dialog shows model dropdown with default option and model list"
    - "Agent form dialog shows traits checkbox list in scrollable container"
    - "Selected traits are submitted with form via hidden inputs"
  artifacts:
    - path: "app/components/ui/checkbox.tsx"
      provides: "shadcn checkbox component"
      contains: "CheckboxPrimitive"
    - path: "app/components/agent-form-dialog.tsx"
      provides: "Extended form with capability, model, traits fields"
      contains: ["capability", "model", "traitIds"]
  key_links:
    - from: "app/components/agent-form-dialog.tsx"
      to: "app/lib/models.ts"
      via: "import AVAILABLE_MODELS"
      pattern: "AVAILABLE_MODELS"
    - from: "app/components/agent-form-dialog.tsx"
      to: "form hidden inputs"
      via: "traitIds submission"
      pattern: "name=\"traitIds\""
---

<objective>
Extend agent form dialog with capability, model, and traits configuration UI controls.

Purpose: Enable users to configure agent settings (AGNT-07, AGNT-08, AGNT-09) through the create/edit form.
Output: Updated agent-form-dialog with three new configuration sections.
</objective>

<execution_context>
@/Users/brendan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brendan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-agent-configuration/08-RESEARCH.md
@.planning/phases/08-agent-configuration/08-01-SUMMARY.md

@app/components/agent-form-dialog.tsx
@app/components/ui/select.tsx
@app/lib/models.ts
@app/db/schema/agents.ts
@app/db/schema/traits.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shadcn checkbox component</name>
  <files>app/components/ui/checkbox.tsx</files>
  <action>
Add the checkbox component from shadcn:

```bash
cd /Users/brendan/code/valet && npx shadcn@latest add checkbox
```

This installs @radix-ui/react-checkbox if needed and creates the component file.

If the command prompts for confirmation, accept defaults. The component should be created at app/components/ui/checkbox.tsx.
  </action>
  <verify>File exists: `ls /Users/brendan/code/valet/app/components/ui/checkbox.tsx`</verify>
  <done>checkbox.tsx component exists in ui directory</done>
</task>

<task type="auto">
  <name>Task 2: Extend agent form dialog with configuration fields</name>
  <files>app/components/agent-form-dialog.tsx</files>
  <action>
Extend AgentFormDialog with capability, model, and traits configuration:

1. Update props interface to accept traits list:
   ```typescript
   interface AgentFormDialogProps {
     agent?: Pick<Agent, "id" | "name" | "instructions" | "capability" | "model"> & {
       traitIds?: string[];
     };
     traits?: Array<{ id: string; name: string }>;
     trigger: ReactNode;
   }
   ```

2. Add state for selected trait IDs:
   ```typescript
   const [selectedTraitIds, setSelectedTraitIds] = useState<string[]>([]);
   ```

3. Initialize selectedTraitIds from agent when dialog opens:
   ```typescript
   useEffect(() => {
     if (open) {
       setSelectedTraitIds(agent?.traitIds ?? []);
     }
   }, [open, agent?.traitIds]);
   ```

4. Add Capability Select after Instructions field:
   ```tsx
   <div className="space-y-2">
     <Label htmlFor="capability">Capability</Label>
     <Select name="capability" defaultValue={agent?.capability ?? "none"}>
       <SelectTrigger id="capability" className="w-full">
         <SelectValue />
       </SelectTrigger>
       <SelectContent>
         <SelectItem value="none">Text only</SelectItem>
         <SelectItem value="search">Web search</SelectItem>
         <SelectItem value="fetch">URL fetch</SelectItem>
       </SelectContent>
     </Select>
     <p className="text-xs text-muted-foreground">
       Determines what tools the agent can use when executing.
     </p>
   </div>
   ```

5. Add Model Select after Capability:
   ```tsx
   <div className="space-y-2">
     <Label htmlFor="model">Model</Label>
     <Select name="model" defaultValue={agent?.model ?? ""}>
       <SelectTrigger id="model" className="w-full">
         <SelectValue placeholder="Use default from settings" />
       </SelectTrigger>
       <SelectContent>
         <SelectItem value="">Use default from settings</SelectItem>
         {AVAILABLE_MODELS.map((model) => (
           <SelectItem key={model.id} value={model.id}>
             {model.name}
           </SelectItem>
         ))}
       </SelectContent>
     </Select>
     <p className="text-xs text-muted-foreground">
       Override the default model for this agent.
     </p>
   </div>
   ```

6. Add Traits checkbox list after Model:
   ```tsx
   <div className="space-y-2">
     <Label>Traits</Label>
     <div className="max-h-40 overflow-y-auto space-y-2 border rounded-md p-3">
       {(!traits || traits.length === 0) ? (
         <p className="text-sm text-muted-foreground">
           No traits available. Create traits in the Traits library.
         </p>
       ) : (
         traits.map((trait) => (
           <div key={trait.id} className="flex items-center space-x-2">
             <Checkbox
               id={`trait-${trait.id}`}
               checked={selectedTraitIds.includes(trait.id)}
               onCheckedChange={(checked) => {
                 setSelectedTraitIds((prev) =>
                   checked
                     ? [...prev, trait.id]
                     : prev.filter((id) => id !== trait.id)
                 );
               }}
             />
             <label
               htmlFor={`trait-${trait.id}`}
               className="text-sm cursor-pointer"
             >
               {trait.name}
             </label>
           </div>
         ))
       )}
     </div>
     <p className="text-xs text-muted-foreground">
       Assign traits to include their context in the agent's prompt.
     </p>
   </div>
   ```

7. Add hidden inputs for trait submission (inside the form, after traits section):
   ```tsx
   <input type="hidden" name="traitsUpdated" value="true" />
   {selectedTraitIds.map((id) => (
     <input key={id} type="hidden" name="traitIds" value={id} />
   ))}
   ```

8. Add required imports:
   - AVAILABLE_MODELS from "~/lib/models"
   - Checkbox from "~/components/ui/checkbox"
   - Select, SelectTrigger, SelectValue, SelectContent, SelectItem from "~/components/ui/select"

Note: The traitsUpdated hidden input is a marker so the action knows to update traits even when no traits are selected (allows removing all traits).
  </action>
  <verify>TypeScript compiles: `cd /Users/brendan/code/valet && npx tsc --noEmit`</verify>
  <done>agent-form-dialog.tsx has Capability Select, Model Select, and Traits checkbox list with hidden inputs for form submission</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. checkbox.tsx exists in components/ui/
3. agent-form-dialog.tsx includes:
   - Capability Select with none/search/fetch options
   - Model Select with default option and AVAILABLE_MODELS
   - Traits checkbox list in scrollable container
   - Hidden inputs for traitIds and traitsUpdated marker
</verification>

<success_criteria>
- Checkbox component installed from shadcn
- Agent form shows capability dropdown (Text only / Web search / URL fetch)
- Agent form shows model dropdown (Use default + all models from AVAILABLE_MODELS)
- Agent form shows traits list with checkboxes (or empty state message)
- Selected traits submitted via hidden inputs with traitsUpdated marker
</success_criteria>

<output>
After completion, create `.planning/phases/08-agent-configuration/08-02-SUMMARY.md`
</output>
