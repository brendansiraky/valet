# Milestone v1.1: Enhanced Agents

**Status:** SHIPPED 2026-01-29
**Phases:** 7-10
**Total Plans:** 8

## Overview

Milestone v1.1 (Enhanced Agents) added traits (reusable context snippets), per-agent model/trait configuration, unified pipeline capabilities (web search + URL fetch), cost visibility, and dead code cleanup.

## Phases

### Phase 7: Navigation & Traits

**Goal**: App has persistent navigation and users can create reusable context snippets
**Depends on**: Phase 1 (user authentication)
**Plans**: 2 plans

Plans:
- [x] 07-01-PLAN.md - Sidebar navigation and authenticated layout
- [x] 07-02-PLAN.md - Traits database schema and CRUD UI

**Details:**
- shadcn sidebar with collapsible=icon for collapse behavior
- Cookie-based sidebar state persistence
- layout() wrapper in routes.ts for auth centralization
- Traits table with id, userId, name, context, timestamps
- TraitFormDialog and TraitCard components
- Trait context max 50000 chars (larger than agent instructions)

### Phase 8: Agent Configuration

**Goal**: Users can configure agents with model and trait settings
**Depends on**: Phase 7 (traits must exist before assignment)
**Plans**: 3 plans

Plans:
- [x] 08-01-PLAN.md - Schema extension (model column, agent-traits junction table)
- [x] 08-02-PLAN.md - Agent form UI (model/traits configuration)
- [x] 08-03-PLAN.md - Data integration (loader/action, trait context in execution)

**Details:**
- Capability default 'none' for backward compatibility
- Model nullable means use user's default from settings
- Composite primary key for junction tables (prevents duplicates)
- Trait context format: ## {name}\n\n{context} with --- separator
- buildSystemPrompt helper centralizes trait context injection
- Model cascade: agent.model -> apiKey.modelPreference -> default

### Phase 9: Pipeline & Cost

**Goal**: Pipeline execution uses unified tools and shows cost information
**Depends on**: Phase 5 (execution engine), Phase 8 (agent configuration)
**Plans**: 2 plans

Plans:
- [x] 09-01-PLAN.md - Pricing module and unified tools executor
- [x] 09-02-PLAN.md - Cost display in pipeline completion UI

**Details:**
- Unified tools: all agents have web_search + web_fetch, model infers from context
- Pricing fallback to Sonnet if model unknown
- Pipeline uses single model for all steps
- Usage accumulator pattern for multi-step token tracking
- Usage summary shows only when both usage and model present

### Phase 10: Polish & Cleanup

**Goal**: Clean codebase with unused capability files removed and no debug artifacts
**Depends on**: Phase 9
**Plans**: 1 plan

Plans:
- [x] 10-01-PLAN.md - Delete unused capability files and remove dead code

**Details:**
- Deleted text-generation.server.ts, web-search.server.ts, url-fetch.server.ts
- Removed unused AgentCapability type export
- Removed debug console.log from pipeline page
- Kept capability column in database (migration not worth it)

---

## Milestone Summary

**Key Decisions:**
- Unified tools: all agents have web_search + web_fetch (no capability dropdown)
- Trait context max 50000 chars for reusable context blocks
- Model cascade: agent.model -> apiKey.modelPreference -> default
- Cookie-based sidebar state persistence (SSR-compatible)
- Pricing fallback to Sonnet if model unknown

**Issues Resolved:**
- Capability selector removed (model infers from context)
- Agent test dialog uses agent's configured settings
- Pipeline execution now has full tool access

**Issues Deferred:**
- Toast notifications (sonner not installed, separate scope)
- AGUX-01/02/03 requirements dropped (capability dropdown removed entirely)

**Technical Debt Incurred:**
- TODO comments for toast error display (3 locations in pipelines.$id.tsx)
- Legacy capability column exists in agents table (harmless, has default)

---

_For current project status, see .planning/ROADMAP.md_
