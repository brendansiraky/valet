# Milestone v1.2: Multi-Provider & Artifacts

**Status:** ✅ SHIPPED 2026-01-29
**Phases:** 11-14
**Total Plans:** 9

## Overview

Milestone v1.2 adds multi-provider support (Anthropic + OpenAI), improved model selection UX, live agent-pipeline relationships, and persistent artifact storage.

## Phases

### Phase 11: Provider Abstraction Layer

**Goal**: Create abstraction layer for AI providers with Anthropic as first implementation
**Depends on**: v1.1 complete
**Plans**: 3 plans

Plans:
- [x] 11-01-PLAN.md — Provider types, registry, and Anthropic implementation
- [x] 11-02-PLAN.md — Refactor services to use provider abstraction
- [x] 11-03-PLAN.md — Orphan detection for deleted agents (backend only)

**Details:**
- Provider interface defining common operations (chat, tools, streaming)
- Anthropic provider implementing the interface
- Factory pattern for providers (need API key at construction)
- Self-registration at module import (avoids initialization races)
- Orphan detection: fail-fast when pipelines reference deleted agents (backend)

### Phase 12: OpenAI Integration

**Goal**: Add OpenAI as second provider with feature parity where possible
**Depends on**: Phase 11 (abstraction layer)
**Plans**: 2 plans

Plans:
- [x] 12-01-PLAN.md — Install SDK, create OpenAI provider, update registry
- [x] 12-02-PLAN.md — Wire into pipeline executor, verify integration

**Details:**
- OpenAI provider implementing abstraction interface
- Use Chat Completions API (not Responses API) for message-based interface consistency
- Skip unsupported tools (web_search, web_fetch) with console.warn instead of throwing
- Registry detection for gpt-*/o3-*/o4-* models
- Multi-provider API key storage (pulled forward from Phase 13 for testing)

### Phase 13: Model Selection UX

**Goal**: Unified model selection across providers with clean UX
**Depends on**: Phase 12 (both providers available)
**Plans**: 2 plans

Plans:
- [x] 13-01-PLAN.md — Create ModelSelector component, integrate into agent form
- [x] 13-02-PLAN.md — Update settings page model selector with provider grouping

**Details:**
- ModelSelector component with flat dropdown grouped by provider
- Only show models for providers with configured API keys
- Special `__default__` value for "Use default from settings" option
- Settings page inline grouped select (different layout from ModelSelector)
- Renamed "Model Preference" to "Default Model" for clarity

### Phase 14: Artifact Storage

**Goal**: Persist pipeline outputs for later viewing
**Depends on**: Phase 11 (can run in parallel with 12-13)
**Plans**: 2 plans

Plans:
- [x] 14-01-PLAN.md — Extend schema with artifact columns, update executor
- [x] 14-02-PLAN.md — Create artifact list and detail UI routes

**Details:**
- JSONB for artifactData (enables flexible queries, future evolution)
- Cost stored as string (numeric type for precision)
- Metadata stored at completion (run date, pipeline, cost, model used)
- Artifact viewer at /artifacts with pagination
- Reuse OutputViewer component for artifact detail display

---

## Milestone Summary

**Key Decisions:**
- Abstraction layer first — clean separation before adding providers
- Live agent-pipeline link — users expect edits to agents to reflect in pipelines
- Factory pattern for providers — need API key at construction
- Self-registration at module import — avoids initialization races
- Chat Completions API (not Responses) — simpler, matches message-based interface
- Skip unsupported tools with warning — don't crash on web_fetch/web_search for OpenAI
- Flat dropdown with grouping — easier to scan than nested menus
- JSONB for artifacts — structured storage, queryable, extensible
- View-only artifacts — start simple, add editing later

**Issues Resolved:**
- Orphan detection for deleted agents (fail-fast behavior)
- Multi-provider API key management
- Model selection filtering by configured providers

**Issues Deferred:**
- Edit/branch artifacts (deferred to v1.3+)
- Per-step provider selection in mixed-provider pipelines (uses first agent's model)
- Orphan indicator in pipeline builder UI (handled via Quick 003)

**Technical Debt Incurred:**
- Missing formal VERIFICATION.md for Phase 12 (verified via user testing, documented in 12-02-SUMMARY.md)
- Orphaned exports: getAllProviderIds(), ProviderModel interface, getModels() methods (designed for future extensibility)
- Mixed-provider within single pipeline uses first agent's model for whole pipeline (not per-step)

---

*For current project status, see .planning/ROADMAP.md*

---
*Archived: 2026-01-29 as part of v1.2 milestone completion*
